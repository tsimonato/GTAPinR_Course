<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-02">

<title>GTAPinR Course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="faq_files/libs/clipboard/clipboard.min.js"></script>
<script src="faq_files/libs/quarto-html/quarto.js"></script>
<script src="faq_files/libs/quarto-html/popper.min.js"></script>
<script src="faq_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="faq_files/libs/quarto-html/anchor.min.js"></script>
<link href="faq_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="faq_files/libs/quarto-html/quarto-syntax-highlighting-14abb8284ba5d94560a5fbf30c1a4bef.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="faq_files/libs/quarto-html/quarto-syntax-highlighting-dark-5c3888f27347c78fd849423dde8c1586.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="faq_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="faq_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="faq_files/libs/bootstrap/bootstrap-88937c81b6ae1f42376f4d8a1f2140b4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="faq_files/libs/bootstrap/bootstrap-dark-b6245bf837ea7795c90180e8fe8a8e90.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GTAPinR Course</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Thiago Simonato </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Research Economist, Center for Global Trade Analysis, Purdue University
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Uris Lantz Baldos </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Research Associate Professor, Center for Global Trade Analysis, Department of Agricultural Economics, Purdue University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="frequently-asked-questions-faq" class="level2">
<h2 class="anchored" data-anchor-id="frequently-asked-questions-faq">Frequently Asked Questions (FAQ)</h2>
<section id="about-the-course-why-r" class="level3">
<h3 class="anchored" data-anchor-id="about-the-course-why-r">About the Course &amp; Why R</h3>
<section id="what-is-the-gtap-model-and-why-is-it-relevant-for-this-course" class="level6">
<h6 class="anchored" data-anchor-id="what-is-the-gtap-model-and-why-is-it-relevant-for-this-course">What is the GTAP Model and why is it relevant for this course?</h6>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The GTAP Model is a computable general equilibrium framework widely used to analyze trade policy, energy and environmental questions, poverty, and migration. Although the model specification is open, the traditional workflow historically relied on proprietary solvers. This course shows how to conduct the same class of analyses in R, so that you can integrate data processing, modeling, and visualization within a single, open-source environment. For step-by-step examples of the workflow, please consult the course website. See more at the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
</section>
<section id="why-should-i-run-gtap-in-r-instead-of-using-proprietary-software" class="level5">
<h5 class="anchored" data-anchor-id="why-should-i-run-gtap-in-r-instead-of-using-proprietary-software">Why should I run GTAP in R instead of using proprietary software?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Running GTAP in R allows you to avoid licensing constraints, run on local machines or in the cloud without license servers, and maintain reproducible pipelines that keep data handling, modeling, and plotting in one place. You also gain access to a large open-source ecosystem and community. For practical demonstrations of this approach, including code and screenshots, refer to the course pages. See also the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
</section>
<section id="which-packages-form-the-core-of-the-gtapinr-approach" class="level5">
<h5 class="anchored" data-anchor-id="which-packages-form-the-core-of-the-gtapinr-approach">Which packages form the core of the GTAPinR approach?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The workflow hinges on two packages. HARr enables reading and writing GTAP header-array and solution files directly within R, whereas tabloToR translates TABLO models, connects the model code to the GTAP Data Base, defines the closure, applies shocks, solves, and exposes results for inspection and plotting. Additional helper packages are used in the course materials; see the website for installation commands and usage examples. See package details in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
</section>
<section id="what-does-gtap-in-r-not-do-or-where-are-its-current-limitations" class="level5">
<h5 class="anchored" data-anchor-id="what-does-gtap-in-r-not-do-or-where-are-its-current-limitations">What does GTAP in R not do or where are its current limitations?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>GTAPinR does not currently include a visual post-processing tool comparable to <a href="https://www.copsmodels.com/gpmanual.htm#gpd8.6">AnalyseGE</a> from the GEMPACK suite, which allows users to decompose results (variables, coefficients, equations) into natural parts interactively. GTAPinR has also not been designed to deliver the same execution performance as dedicated solvers like <a href="https://www.copsmodels.com/gempack.htm">GEMPACK</a> or <a href="https://www.gams.com/">GAMS</a>, especially for large-scale or highly disaggregated models. Especially when model size increases, the runtime in R (with HARr/tabloToR) will generally be slower than in those highly optimized, compiled solver environments.</p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="requirements-setup" class="level3">
<h3 class="anchored" data-anchor-id="requirements-setup">Requirements &amp; Setup</h3>
<section id="what-software-setup-do-you-recommend-before-starting" class="level5">
<h5 class="anchored" data-anchor-id="what-software-setup-do-you-recommend-before-starting">What software setup do you recommend before starting?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You should use a recent version of R and RStudio on Windows, macOS, or Linux, and you should be able to install packages from GitHub. The course’s “Setting Up” section guides you through installing dependencies, configuring your working directory, and verifying that the model files and database are discoverable by R. Please follow that section for exact commands and example scripts. Detailed instructions are in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
</section>
<section id="how-do-i-install-the-key-packages" class="level5">
<h5 class="anchored" data-anchor-id="how-do-i-install-the-key-packages">How do I install the key packages?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can install the packages using <code>devtools::install_github()</code>. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"USDA-ERS/MTED-HARr"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"tsimonato/MTED-TabloToR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Check your working directory and ensure the <code>model</code> subfolder has the necessary files. The course website includes detailed steps and troubleshooting advice. See installation steps in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="r-data-structures" class="level3">
<h3 class="anchored" data-anchor-id="r-data-structures">R Data Structures</h3>
<section id="which-data-structures-in-r-will-i-actually-use-for-gtap-work" class="level5">
<h5 class="anchored" data-anchor-id="which-data-structures-in-r-will-i-actually-use-for-gtap-work">Which data structures in R will I actually use for GTAP work?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You will primarily use data frames for tabular manipulation, arrays for multi-dimensional numeric information that mirrors GTAP headers and solution blocks, and lists that act as containers for these objects. Lists are the natural way to store the collection of headers loaded from a header-array file, whereas arrays preserve dimensional structure for efficient slicing and aggregation. The “Data Structures in R” portion of the course shows concrete indexing patterns and transformations. Examples are provided in the <a href="https://tsimonato.github.io/GTAPinR_Course/#exploring-the-data">https://tsimonato.github.io/GTAPinR_Course/#exploring-the-data</a></p>
</div>
</div>
</div>
</section>
<section id="how-do-i-read-gtap-.har-and-.sl4-files-into-r" class="level5">
<h5 class="anchored" data-anchor-id="how-do-i-read-gtap-.har-and-.sl4-files-into-r">How do I read GTAP .har and .sl4 files into R?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can load header-array files using <code>HARr::read_har("path/to/file.har")</code>, which returns a list whose elements correspond to the headers in the file, with numeric headers stored as arrays. Solution files can be read similarly. After loading, you can call <code>summary()</code> on the returned object to list available headers, access a specific header with the dollar operator, and subset numeric arrays with standard R indexing. The course includes runnable examples. See details in the <a href="https://tsimonato.github.io/GTAPinR_Course/#loading-the-gtap-data-files">https://tsimonato.github.io/GTAPinR_Course/#loading-the-gtap-data-files</a></p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="harr" class="level3">
<h3 class="anchored" data-anchor-id="harr">HARr</h3>
<section id="how-do-i-explore-and-convert-arrays-for-analysis" class="level5">
<h5 class="anchored" data-anchor-id="how-do-i-explore-and-convert-arrays-for-analysis">How do I explore and convert arrays for analysis?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can use <code>summary()</code> to inspect headers, extract arrays with <code>$</code>, and subset with standard R indexing. To convert arrays for plotting, use <code>as.data.frame.table()</code>. This produces a tidy format suitable for filtering and graphing. The course shows practical examples and how to integrate with ggplot2 or ggalluvial for visualization. Examples are shown in the <a href="https://tsimonato.github.io/GTAPinR_Course/#exploring-the-data">https://tsimonato.github.io/GTAPinR_Course/#exploring-the-data</a></p>
</div>
</div>
</div>
</section>
<section id="how-do-i-write-new-.har-files-from-r" class="level5">
<h5 class="anchored" data-anchor-id="how-do-i-write-new-.har-files-from-r">How do I write new .har files from R?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can use the function <code>HARr::write_har()</code> to create new header-array files. Sets should be stored as character vectors, numeric data as arrays with properly defined dimensions, and each header should include a short code and a long description. The course materials demonstrate how to prepare and validate these objects before writing. See instructions in the <a href="https://tsimonato.github.io/GTAPinR_Course/#writing-data">https://tsimonato.github.io/GTAPinR_Course/#writing-data</a></p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="tablotor" class="level3">
<h3 class="anchored" data-anchor-id="tablotor">tabloToR</h3>
<section id="what-is-a-gemodel-object-and-why-do-i-need-it" class="level5">
<h5 class="anchored" data-anchor-id="what-is-a-gemodel-object-and-why-do-i-need-it">What is a GEModel object and why do I need it?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The GEModel object is the container for a single experiment. It holds the parsed TABLO model, the database built with <code>HARr::read_har</code>, the closure, shocks, the solver, and the results. The course demonstrates how to create and use GEModel step by step. See model initialization in the <a href="https://tsimonato.github.io/GTAPinR_Course/#initializing-the-gtap-model">https://tsimonato.github.io/GTAPinR_Course/#initializing-the-gtap-model</a></p>
</div>
</div>
</div>
</section>
<section id="what-is-a-closure-and-how-do-i-specify-it" class="level5">
<h5 class="anchored" data-anchor-id="what-is-a-closure-and-how-do-i-specify-it">What is a closure and how do I specify it?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The closure defines which variables are exogenous and which are endogenous. In tabloToR, you set exogenous variables and initialize their shocks, typically starting from zero. The course provides examples of closures and explains how to switch them depending on your research scenario. See closure examples in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks">https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks</a></p>
</div>
</div>
</div>
</section>
<section id="how-do-i-apply-a-policy-shock-and-solve-the-model" class="level5">
<h5 class="anchored" data-anchor-id="how-do-i-apply-a-policy-shock-and-solve-the-model">How do I apply a policy shock and solve the model?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>After loading the TABLO file and database into a GEModel and defining a closure, you can assign a value to an exogenous variable as a shock and run the solver. For example, you could model a productivity increase by setting the relevant variable exogenous, applying a positive change, and then calling the solve function. The course demonstrates this with hands-on exercises. Detailed workflow is in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks">https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks</a></p>
</div>
</div>
</div>
</section>
<section id="where-are-results-stored-and-how-do-i-save-them" class="level5">
<h5 class="anchored" data-anchor-id="where-are-results-stored-and-how-do-i-save-them">Where are results stored and how do I save them?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>After solving, results are stored in the outputData list inside the GEModel. You can inspect updated arrays directly or convert them to data frames for plotting. To persist results, you can use <code>saveRDS()</code> and reload them later with <code>readRDS()</code>. The course shows practical examples of saving, reloading, and comparing results across runs. See outputs in the <a href="https://tsimonato.github.io/GTAPinR_Course/#solving-and-interpreting-the-results">https://tsimonato.github.io/GTAPinR_Course/#solving-and-interpreting-the-results</a></p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="troubleshooting" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h3>
<section id="why-am-i-getting-an-error-when-installing-packages-from-github" class="level5">
<h5 class="anchored" data-anchor-id="why-am-i-getting-an-error-when-installing-packages-from-github">Why am I getting an error when installing packages from GitHub?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you encounter an error when installing a package from GitHub, a good first step is to check the package’s built-in documentation directly in R using the help command. For example, you can type <code>?devtools</code> in the R console to see installation notes, usage instructions, and troubleshooting tips provided by the package authors. Additionally, ensure that you have the latest version of R and RStudio, as well as the necessary system dependencies for building packages from source. If the problem persists, consider searching online forums or the package’s GitHub issues page for similar problems and solutions. The course provides additional guidance on common installation issues. See more in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up">https://tsimonato.github.io/GTAPinR_Course/#setting-up</a></p>
</div>
</div>
</div>
</section>
<section id="why-cant-i-open-a-.har-file-that-i-am-certain-exists" class="level5">
<h5 class="anchored" data-anchor-id="why-cant-i-open-a-.har-file-that-i-am-certain-exists">Why can’t I open a .har file that I am certain exists?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The most common cause is a mismatch in working directory or file path. You should check the current working directory with <code>getwd()</code> and confirm the path. Encoding issues in header names may also cause failures. The course offers methods to test file paths and confirm encoding. Check file handling in the <a href="https://tsimonato.github.io/GTAPinR_Course/#loading-the-gtap-data-files">https://tsimonato.github.io/GTAPinR_Course/#loading-the-gtap-data-files</a></p>
</div>
</div>
</div>
</section>
<section id="why-does-tablotor-fail-to-solve-or-complain-about-variables-not-found" class="level5">
<h5 class="anchored" data-anchor-id="why-does-tablotor-fail-to-solve-or-complain-about-variables-not-found">Why does tabloToR fail to solve or complain about variables not found?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This typically means that the closure is inconsistent with the TABLO file, or a shock was applied to a variable that was not defined as exogenous. Re-check variable names in the TABLO file and ensure that your closure aligns with your shocks. The course includes troubleshooting checklists for these cases. See guidance in the <a href="https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks">https://tsimonato.github.io/GTAPinR_Course/#setting-up-closure-and-shocks</a></p>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="advanced" class="level3">
<h3 class="anchored" data-anchor-id="advanced">Advanced</h3>
<section id="can-i-compare-tablotor-results-with-gempack" class="level5">
<h5 class="anchored" data-anchor-id="can-i-compare-tablotor-results-with-gempack">Can I compare tabloToR results with GEMPACK?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Yes. You can read GEMPACK .sl4 files using HARr, convert them to data frames, and compare directly with tabloToR output using the same conversion. When the same closure and solution method are applied, the results are highly comparable. The course illustrates this process and highlights small differences you may encounter. Comparison examples are provided in the <a href="https://tsimonato.github.io/GTAPinR_Course/#solving-and-interpreting-the-results">https://tsimonato.github.io/GTAPinR_Course/#solving-and-interpreting-the-results</a></p>
</div>
</div>
</div>
</section>
<section id="can-i-extend-the-workflow-to-baselines-or-regional-models" class="level5">
<h5 class="anchored" data-anchor-id="can-i-extend-the-workflow-to-baselines-or-regional-models">Can I extend the workflow to baselines or regional models?</h5>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The package has been developed and tested specifically with the standard GTAP version 7 model. While it is technically possible that the workflow could be adapted for other models or for extensions such as baseline construction and regional disaggregation, these uses have not been the focus of development and have not been systematically tested. Users attempting such applications should be aware of these limitations.</p>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>