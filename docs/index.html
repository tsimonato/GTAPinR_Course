<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-05-30">

<title>GTAPinR Course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="roadmap_gtapinr_files/libs/clipboard/clipboard.min.js"></script>
<script src="roadmap_gtapinr_files/libs/quarto-html/quarto.js"></script>
<script src="roadmap_gtapinr_files/libs/quarto-html/popper.min.js"></script>
<script src="roadmap_gtapinr_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="roadmap_gtapinr_files/libs/quarto-html/anchor.min.js"></script>
<link href="roadmap_gtapinr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="roadmap_gtapinr_files/libs/quarto-html/quarto-syntax-highlighting-14abb8284ba5d94560a5fbf30c1a4bef.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="roadmap_gtapinr_files/libs/quarto-html/quarto-syntax-highlighting-dark-5c3888f27347c78fd849423dde8c1586.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="roadmap_gtapinr_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="roadmap_gtapinr_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="roadmap_gtapinr_files/libs/bootstrap/bootstrap-88937c81b6ae1f42376f4d8a1f2140b4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="roadmap_gtapinr_files/libs/bootstrap/bootstrap-dark-b6245bf837ea7795c90180e8fe8a8e90.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="roadmap_gtapinr_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="roadmap_gtapinr_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="roadmap_gtapinr_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="roadmap_gtapinr_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="roadmap_gtapinr_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="roadmap_gtapinr_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="roadmap_gtapinr_files/libs/datatables-binding-0.33/datatables.js"></script>

<script src="roadmap_gtapinr_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="roadmap_gtapinr_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="roadmap_gtapinr_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="roadmap_gtapinr_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="roadmap_gtapinr_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="roadmap_gtapinr_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Course Outline</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul>
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link" data-scroll-target="#setting-up"><span class="header-section-number">1.1</span> Setting Up</a></li>
  <li><a href="#a-brief-overview-of-data-structures-in-r" id="toc-a-brief-overview-of-data-structures-in-r" class="nav-link" data-scroll-target="#a-brief-overview-of-data-structures-in-r"><span class="header-section-number">1.2</span> A Brief Overview of Data Structures in R</a></li>
  </ul></li>
  <li><a href="#running-gtap-in-r" id="toc-running-gtap-in-r" class="nav-link" data-scroll-target="#running-gtap-in-r"><span class="header-section-number">2</span> Running GTAP in R</a>
  <ul>
  <li><a href="#loading-and-exploring-the-gtap-data-base" id="toc-loading-and-exploring-the-gtap-data-base" class="nav-link" data-scroll-target="#loading-and-exploring-the-gtap-data-base"><span class="header-section-number">2.1</span> Loading and exploring the GTAP Data Base</a>
  <ul>
  <li><a href="#loading-the-gtap-data-files" id="toc-loading-the-gtap-data-files" class="nav-link" data-scroll-target="#loading-the-gtap-data-files"><span class="header-section-number">2.1.1</span> Loading the GTAP data files</a></li>
  <li><a href="#extracting-data-in-the-gtap-data-base" id="toc-extracting-data-in-the-gtap-data-base" class="nav-link" data-scroll-target="#extracting-data-in-the-gtap-data-base"><span class="header-section-number">2.1.2</span> Extracting Data in the GTAP Data Base</a></li>
  <li><a href="#converting-data-for-analysis" id="toc-converting-data-for-analysis" class="nav-link" data-scroll-target="#converting-data-for-analysis"><span class="header-section-number">2.1.3</span> Converting Data for Analysis</a></li>
  <li><a href="#exploring-the-data" id="toc-exploring-the-data" class="nav-link" data-scroll-target="#exploring-the-data"><span class="header-section-number">2.1.4</span> Exploring the data</a></li>
  </ul></li>
  <li><a href="#initializing-the-gtap-model-file-and-database-in-r" id="toc-initializing-the-gtap-model-file-and-database-in-r" class="nav-link" data-scroll-target="#initializing-the-gtap-model-file-and-database-in-r"><span class="header-section-number">2.2</span> Initializing the GTAP model file and database in R</a></li>
  <li><a href="#setup-the-model-closure-and-shocks" id="toc-setup-the-model-closure-and-shocks" class="nav-link" data-scroll-target="#setup-the-model-closure-and-shocks"><span class="header-section-number">2.3</span> Setup the model closure and shocks</a></li>
  <li><a href="#solving-the-model-and-viewing-model-outputs" id="toc-solving-the-model-and-viewing-model-outputs" class="nav-link" data-scroll-target="#solving-the-model-and-viewing-model-outputs"><span class="header-section-number">2.4</span> Solving the model and viewing model outputs</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GTAPinR Course</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Thiago Simonato <a href="mailto:tsimonat@purdue.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Research Economist, Center for Global Trade Analysis, Purdue University
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Uris Lantz Baldos <a href="mailto:ubaldos@purdue.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Research Associate Professor, Center for Global Trade Analysis, Department of Agricultural Economics, Purdue University
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Zeynep Akgul <a href="mailto:zakgul@purdue.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            GTAP-U Coordinator, Center for Global Trade Analysis, Purdue University
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Ginger Batta <a href="mailto:gbatta@purdue.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Principal Program Manager, Center for Global Trade Analysis, Department of Agricultural Economics, Purdue University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
p {
  text-align: justify
}
</style>
</div>
<div style="page-break-after: always;"></div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This course introduces new tools to work with <a href="https://www.gtap.agecon.purdue.edu/">GTAP</a> model and database in <a href="https://www.r-project.org/">R</a>. It provides practical hands-on experience starting with the installation of the required packages in R, viewing <em>.har</em> files, setting up and running the standard GTAP model version 7<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in R and exploring model outputs.</p>
<p>The key packages used in the course includes:</p>
<ol type="1">
<li><p><a href="https://github.com/USDA-ERS/MTED-HARr">HARr</a> package, which serves as a bridge between the databases and the R language by reading and writing <em>.har</em> files adopted in the <a href="https://www.copsmodels.com/gpmanual.htm#gpd5.8.1">GEMPACK</a> suite.</p></li>
<li><p><a href="https://github.com/tsimonato/MTED-TabloToR">TabloToR</a> package allows users to run GTAP simulations by reading in and compiling the GEMPACK-style TABLO <em>.tab</em> files and solving it within the R environment<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p></li>
</ol>
<p>The diagram below summarizes the basic workflow for running GTAP in R. It starts with initializing the model, followed by configuring and reading in the database, model translation from TABLO to R, closure setup, and shock application. The process concludes with running the model to viewing results.</p>
<div class="cell" data-fig-width="5.5" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Initialize] --&gt;|"tabloToR::GEModel$new()"| EM{Model Outline}
    EM --&gt; |"model$loadData(database)"| B{Gtapv7 Model}
    EM --&gt; |"model$loadTablo(gtapv7.tab)"| B
    H[Setup closure] --&gt;|"exogenous_variables &lt;- 0"| B
    Z[Setup shocks] --&gt;|"shock_variables &lt;- X"| B
    B --&gt; |"model$solveModel()"| C[Get the results]
    
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<section id="setting-up" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="setting-up"><span class="header-section-number">1.1</span> Setting Up</h2>
<ol type="a">
<li><p>Make sure that you have <strong>R</strong> installed on your computer. You can download the latest version of R from the <a href="https://www.r-project.org/">Comprehensive R Archive Network (CRAN)</a>.</p></li>
<li><p>After installing R, install <strong>RStudio</strong>, a powerful and user-friendly integrated development environment for R. RStudio can be downloaded from the <a href="https://posit.co/download/rstudio-desktop/">official RStudio website</a>.</p></li>
<li><p>Open the <strong>roadmap_gtapinr.r</strong> course folder using R studio. This is a blank R file. You will use this to copy/paste/write and run R codes that you will see throughout this course.</p></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Set the working directory to the folder where the R file that you are editing is located. This is important since R will read the GTAP model file and database in the <strong>model</strong> subfolder. You can also manually set the working directory using the following codes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Using R studio feature</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">dirname</span>(rstudioapi<span class="sc">::</span><span class="fu">getActiveDocumentContext</span>()<span class="sc">$</span>path))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">#### Manually set working directory in R</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"D:/Daily_Work/2022 USDA GTAPinR/2024 GTAPinR newfiles/202403"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">#### Check the working directory to ensure it is correctly set:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<ol start="4" type="a">
<li>Install <a href="https://cran.r-project.org/web/packages/devtools/index.html">devtools</a>, <a href="https://github.com/tsimonato/MTED-TabloToR">TabloToR</a> and <a href="https://github.com/mivanic/HARr">HARr</a> packages. You can install these packages using the following commands in R:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'USDA-ERS/MTED-HARr'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'tsimonato/MTED-TabloToR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Make sure your current working directory is correct and that the <strong>model</strong> subfolder has the following files: sets.har, default.prm, dasedata.har, gtapv7.tab</li>
<li>Make sure that the required R packages are installed correctly: <a href="https://cran.r-project.org/web/packages/devtools/index.html">devtools</a>, <a href="https://github.com/tsimonato/MTED-TabloToR">TabloToR</a> and <a href="https://github.com/tsimonato/MTED-TabloToR">HARr</a> packages.</li>
</ul>
</div>
</div>
</section>
<section id="a-brief-overview-of-data-structures-in-r" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="a-brief-overview-of-data-structures-in-r"><span class="header-section-number">1.2</span> A Brief Overview of Data Structures in R</h2>
<p>R provides several data structures for handling data. Among the most commonly used are <a href="https://rstudio.github.io/r-manuals/r-intro/Lists-and-data-frames.html#data-frames">Data.frames</a>, <a href="https://rstudio.github.io/r-manuals/r-intro/Arrays-and-matrices.html#arrays">Arrays</a>, and <a href="https://rstudio.github.io/r-manuals/r-intro/Lists-and-data-frames.html#lists">Lists</a>. Each structure has its unique features and use cases.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Data.frames</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Arrays</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Lists</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>A <a href="https://rstudio.github.io/r-manuals/r-intro/Lists-and-data-frames.html#data-frames">Data.frame</a> is a table or a two-dimensional array-like structure in which each column contains values of one variable and each row contains one set of values from each column. Example of a Data.frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Creating a data.frame object in R</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Commodities =</span> <span class="fu">c</span>(<span class="st">"Wheat"</span>, <span class="st">"Corn"</span>, <span class="st">"Wheat"</span>, <span class="st">"Corn"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Activities =</span> <span class="fu">c</span>(<span class="st">"Farming"</span>, <span class="st">"Farming"</span>, <span class="st">"Harvesting"</span>, <span class="st">"Harvesting"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Margins =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d3d9afff91f155a154da" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d3d9afff91f155a154da">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Wheat","Corn","Wheat","Corn"],["Farming","Farming","Harvesting","Harvesting"],["Low","High","Low","High"],[1,2,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Commodities<\/th>\n      <th>Activities<\/th>\n      <th>Margins<\/th>\n      <th>Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"paging":false,"info":false,"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Commodities","targets":1},{"name":"Activities","targets":2},{"name":"Margins","targets":3},{"name":"Values","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>.</p>
<p>Subsetting in a Data.frame can be done to select specific rows, columns, or both:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Filter by row</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Filter by column</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Filter by rows and columns</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Here, we select rows where the <code>Values</code> column is greater than 2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Filter df$Values which are greater than 2</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>Values <span class="sc">&gt;</span> <span class="dv">2</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Commodities Activities Margins Values
3       Wheat Harvesting     Low      3
4        Corn Harvesting    High      4</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Here, we select the ‘Commodities’ column</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Select the 'Commodities' column in 'df' data.frame </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Commodities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wheat" "Corn"  "Wheat" "Corn" </code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Here, we select rows where ‘Values’ is greater than 2 and only the ‘Commodities’ and ‘Activities’ columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Select rows where 'Values' is greater than 2 and only the 'Commodities' and 'Activities' columns in 'df' data.frame</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>Values <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Commodities"</span>, <span class="st">"Activities"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Commodities Activities
3       Wheat Harvesting
4        Corn Harvesting</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>An <a href="https://rstudio.github.io/r-manuals/r-intro/Arrays-and-matrices.html#arrays">Array</a> in R is a multi-dimensional data structure that can store data in more than two dimensions. Arrays are useful for performing mathematical operations on multi-dimensional data.</p>
<p>This is important since headers extracted from the <em>.har</em> files are treated as arrays in R.</p>
<p>Example of an Array:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Creating an array object in R</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>array_data <span class="ot">&lt;-</span> <span class="fu">array</span>(df<span class="sc">$</span>Values, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(array_data) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(df<span class="sc">$</span>Commodities),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(df<span class="sc">$</span>Activities),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(df<span class="sc">$</span>Margins)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>array_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , Low

      Farming Harvesting
Wheat       1          3
Corn        2          4

, , High

      Farming Harvesting
Wheat       1          3
Corn        2          4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Subsetting data from an Array</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>array_subset <span class="ot">&lt;-</span> array_data[<span class="st">"Wheat"</span>, <span class="st">"Farming"</span>, ]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>array_subset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Low High 
   1    1 </code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>A <a href="https://rstudio.github.io/r-manuals/r-intro/Lists-and-data-frames.html#lists">List</a> is a collection of elements that can be of different types and structures. You can think of a list as a container that holds a variety of objects, which can be accessed and <a href="https://rstudio.github.io/r-manuals/r-intro/Lists-and-data-frames.html#constructing-and-modifying-lists">manipulated individually</a>.</p>
<p>Example of a List:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Creating a list object in R</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>list_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data_Frame =</span> df,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Array =</span> array_data,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Details =</span> <span class="fu">list</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Commodities =</span> <span class="fu">unique</span>(df<span class="sc">$</span>Commodities),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Activities =</span> <span class="fu">unique</span>(df<span class="sc">$</span>Activities),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Margins =</span> <span class="fu">unique</span>(df<span class="sc">$</span>Margins)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>list_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Data_Frame
  Commodities Activities Margins Values
1       Wheat    Farming     Low      1
2        Corn    Farming    High      2
3       Wheat Harvesting     Low      3
4        Corn Harvesting    High      4

$Array
, , Low

      Farming Harvesting
Wheat       1          3
Corn        2          4

, , High

      Farming Harvesting
Wheat       1          3
Corn        2          4


$Details
$Details$Commodities
[1] "Wheat" "Corn" 

$Details$Activities
[1] "Farming"    "Harvesting"

$Details$Margins
[1] "Low"  "High"</code></pre>
</div>
</div>
<p>You can subset elements of a list using the <code>$</code>. For nested lists, you can chain these operators to access deeper levels.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Select a Data.frame within the list</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Select a specific column in the Data.frame</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Select a specific value in the Array</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Selecting data.frame within the list</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>list_data<span class="sc">$</span>Data_Frame</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Commodities Activities Margins Values
1       Wheat    Farming     Low      1
2        Corn    Farming    High      2
3       Wheat Harvesting     Low      3
4        Corn Harvesting    High      4</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Selecting data.frame$Commodities within the list</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>list_data<span class="sc">$</span>Data_Frame<span class="sc">$</span>Commodities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wheat" "Corn"  "Wheat" "Corn" </code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Selecting specific values in Array within the list</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>list_data<span class="sc">$</span>Array[<span class="st">"Wheat"</span>, <span class="st">"Farming"</span>, <span class="st">"Low"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="running-gtap-in-r" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Running GTAP in R</h1>
<p>In this section, you will follow the step-by-step instructions to run GTAP simulations in R. You will learn how to do the following tasks: import and examine <em>.har</em> files in R, loading and initializing model inputs and model code within the R environment, executing simulations, and exploring the results.</p>
<section id="loading-and-exploring-the-gtap-data-base" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="loading-and-exploring-the-gtap-data-base"><span class="header-section-number">2.1</span> Loading and exploring the GTAP Data Base</h2>
<p>GEMPACK utilizes custom <em>.har</em> binary data files to store information. The R package <a href="https://github.com/USDA-ERS/MTED-HARr">HARr</a> enables R to directly read these <em>.har</em> files. It converts the data in these headers, including set information, into a <a href="https://rstudio.github.io/r-manuals/r-intro/Arrays-and-matrices.html">list</a> of <a href="https://rstudio.github.io/r-manuals/r-intro/Arrays-and-matrices.html">arrays</a>, in which each array represents a header of the <em>.har</em> file.</p>
<p>In this step, you will write a script to read the GTAP basedata and explore specific headers within them. Specifically, you will extract and examine the header <code>vdfb</code> (Domestic purchases, by firms, at basic prices).</p>
<section id="loading-the-gtap-data-files" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="loading-the-gtap-data-files"><span class="header-section-number">2.1.1</span> Loading the GTAP data files</h3>
<p>In this step, you will learn how to load the GTAP model’s database files into R using the <a href="https://github.com/USDA-ERS/MTED-HARr">HARr</a> package. This step is crucial as it sets the foundation for solving the model. You will focus on how to read <em>.har</em> files in a specific way and understand their structure within the R environment.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 1: Create <code>database</code> list which reads in the GTAP basedata, parameters and set files in R
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create `database` list which reads in the GTAP basedata,</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  parameters and set files in R</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>database <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapsets =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'??????'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapdata =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'??????'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapparm =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'??????'</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create `database` list which reads in the GTAP basedata,</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  parameters and set files in R</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>database <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapsets =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'model</span><span class="sc">\\</span><span class="st">sets.har'</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapdata =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'model</span><span class="sc">\\</span><span class="st">basedata.har'</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">gtapparm =</span> HARr<span class="sc">::</span><span class="fu">read_har</span>(<span class="st">'model</span><span class="sc">\\</span><span class="st">default.prm'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <a href="https://github.com/USDA-ERS/MTED-HARr">HARr</a> package loads the <em>.har</em> files and stores them as array objects in R named *sets.har<strong>, </strong>default.prm<strong>, and </strong>basedata.har** into R and stores the files as a list named <code>database</code>, with keys <code>gtapsets</code>, <code>gtapdata</code>, and <code>gtapparm</code> respectively.</p>
<p>The name of each list must be the same as the files specified in the <strong>TABLO</strong> code, preferably in lowercase. If you open the <em>gtapv7.tab</em>, file you should see the following lines:</p>
<p><em>GTAPv7.tab</em>, line 99:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>File  GTAPSETS <span class="co"># file with set specification #;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>File  GTAPDATA <span class="co"># file containing all Base Data #;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>File  GTAPPARM <span class="co"># file containing behavioral parameters #;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="extracting-data-in-the-gtap-data-base" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="extracting-data-in-the-gtap-data-base"><span class="header-section-number">2.1.2</span> Extracting Data in the GTAP Data Base</h3>
<p>This task involves extracting specific headers from the loaded GTAP Data Base, with a focus on the <code>vmfp</code> header. You will learn how to filter this data by region and activity. This exercise will assist you to become familiar with the format and structure of the data used in these packages.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 2: Extracting the <code>vmfp</code> header in the <code>database</code> list
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and store 'vmfp' header as array object vmfp</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>vmfp <span class="ot">&lt;-</span> database<span class="sc">$</span>??????<span class="sc">$</span>??????</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>vmfp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and store 'vmfp' header as array object vmfp</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>vmfp <span class="ot">&lt;-</span> database<span class="sc">$</span>gtapdata<span class="sc">$</span>vmfp </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>vmfp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , reg = ssa

       acts
comm        food      mnfcs      svces
  food  3053.641   847.5477   699.6063
  mnfcs 4988.493 21711.2031 13755.7686
  svces 1352.623  2573.5461  5244.4595

, , reg = eu

       acts
comm         food     mnfcs     svces
  food  106757.54  19543.31  21146.19
  mnfcs  42000.44 729110.94 210368.31
  svces  12873.86  67352.26 198928.09

, , reg = row

       acts
comm         food      mnfcs     svces
  food  132265.84   38923.74  30186.41
  mnfcs  85475.67 1269135.12 430168.25
  svces  21010.39   74416.02 211477.12</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Recall in Task 1, you stored the <em>.har</em> files as a list named <code>database</code>, with keys <code>gtapsets</code>, <code>gtapdata</code>, and <code>gtapparm</code> respectively. You can then use R’s traditional sublist selector <code>$</code> to subset lists and [,,] to subset the array in its 3 dimensions. Note that all characters in the database are in lower case, including the name of the headers.</p>
<p>To display the available headers in the <code>database</code> list, you can use the <code>names()</code> function in R. To view the number of dimensions and dimension names in an array you can use the <code>dim()</code> and <code>dimnames()</code> function in R</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show headers gtapdata array</span></span>
<span id="annotated-cell-28-2"><a href="#annotated-cell-28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(database<span class="sc">$</span>gtapdata)</span>
<span id="annotated-cell-28-3"><a href="#annotated-cell-28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show number of dimensions of vmfp array object</span></span>
<span id="annotated-cell-28-4"><a href="#annotated-cell-28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vmfp) </span>
<span id="annotated-cell-28-5"><a href="#annotated-cell-28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show names of dimensions of vmfp array object</span></span>
<span id="annotated-cell-28-6"><a href="#annotated-cell-28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(vmfp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "xxcr" "xxcd" "xxcp" "dver" "dpsm" "evfp" "evos" "save" "vosb" "vdep"
[11] "vdfp" "vdfb" "vdgp" "vdgb" "vdpp" "vdpb" "vdip" "vdib" "evfb" "vmfp"
[21] "vmfb" "vmgp" "vmgb" "vmpp" "vmpb" "vmip" "vmib" "vmsb" "vcif" "vkb" 
[31] "vst"  "vtwr" "vfob" "vxsb" "maks" "makb"
[1] 3 3 3
$comm
[1] "food"  "mnfcs" "svces"

$acts
[1] "food"  "mnfcs" "svces"

$reg
[1] "ssa" "eu"  "row"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 3: Filter for <code>food</code> elements in <code>acts</code> set in <code>vmfp</code> array object
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for `food` elements in `acts` set in `vmfp` array object</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>vmfp_food <span class="ot">&lt;-</span> database<span class="sc">$</span>gtapdata<span class="sc">$</span>vmfp[<span class="st">'?????'</span>,<span class="st">'?????'</span>,<span class="st">'??????'</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>vmfp_food</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for `food` elements in `acts` set in `vmfp` array object</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>vmfp_food <span class="ot">&lt;-</span> database<span class="sc">$</span>gtapdata<span class="sc">$</span>vmfp[,<span class="st">"food"</span>,]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>vmfp_food</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       reg
comm         ssa        eu       row
  food  3053.641 106757.54 132265.84
  mnfcs 4988.493  42000.44  85475.67
  svces 1352.623  12873.86  21010.39</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To filter an array, you need to know the number and order of its dimensions, in the case of vmfp: <code>[comm,acts,reg]</code>. To view the number of dimensions and dimension names in an array you can use the <code>dim()</code> and <code>dimnames()</code> function in R</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-33"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-33-1"><a href="#annotated-cell-33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show number of dimensions of vmfp array object</span></span>
<span id="annotated-cell-33-2"><a href="#annotated-cell-33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vmfp) </span>
<span id="annotated-cell-33-3"><a href="#annotated-cell-33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show names of dimensions of vmfp array object</span></span>
<span id="annotated-cell-33-4"><a href="#annotated-cell-33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(vmfp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 3
$comm
[1] "food"  "mnfcs" "svces"

$acts
[1] "food"  "mnfcs" "svces"

$reg
[1] "ssa" "eu"  "row"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="converting-data-for-analysis" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="converting-data-for-analysis"><span class="header-section-number">2.1.3</span> Converting Data for Analysis</h3>
<p>In this task, you will convert the extracted array data into a <code>data.frame.table</code> format using base R. This conversion is essential for making the data more accessible and easier to analyze using various R functions and packages like <code>data.table</code>, <code>dplyr</code> and <code>tidyr.</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 4: Convert the <code>vmfp</code> array into a <code>data.frame.table</code> object
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the `vmfp` array into a `data.frame.table` object</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>vmfp_df <span class="ot">&lt;-</span> as.?????(vmfp)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>vmfp_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert vmfp into data.frame.table</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the `vmfp` array into a `data.frame.table` object</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>vmfp_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(vmfp)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>vmfp_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    comm  acts reg         Freq
1   food  food ssa    3053.6409
2  mnfcs  food ssa    4988.4932
3  svces  food ssa    1352.6234
4   food mnfcs ssa     847.5477
5  mnfcs mnfcs ssa   21711.2031
6  svces mnfcs ssa    2573.5461
7   food svces ssa     699.6063
8  mnfcs svces ssa   13755.7686
9  svces svces ssa    5244.4595
10  food  food  eu  106757.5391
11 mnfcs  food  eu   42000.4375
12 svces  food  eu   12873.8594
13  food mnfcs  eu   19543.3105
14 mnfcs mnfcs  eu  729110.9375
15 svces mnfcs  eu   67352.2578
16  food svces  eu   21146.1855
17 mnfcs svces  eu  210368.3125
18 svces svces  eu  198928.0938
19  food  food row  132265.8438
20 mnfcs  food row   85475.6719
21 svces  food row   21010.3945
22  food mnfcs row   38923.7422
23 mnfcs mnfcs row 1269135.1250
24 svces mnfcs row   74416.0156
25  food svces row   30186.4141
26 mnfcs svces row  430168.2500
27 svces svces row  211477.1250</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Arrays converted to data.frame through <code>as.data.frame.table()</code> function. Also, keep in mind that they have <em>freq</em> as the name of the column of numerical values.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9bbe5d1aaa76dd314fe8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9bbe5d1aaa76dd314fe8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27"],["food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces","food","mnfcs","svces"],["food","food","food","mnfcs","mnfcs","mnfcs","svces","svces","svces","food","food","food","mnfcs","mnfcs","mnfcs","svces","svces","svces","food","food","food","mnfcs","mnfcs","mnfcs","svces","svces","svces"],["ssa","ssa","ssa","ssa","ssa","ssa","ssa","ssa","ssa","eu","eu","eu","eu","eu","eu","eu","eu","eu","row","row","row","row","row","row","row","row","row"],[3053.640869140625,4988.4931640625,1352.623413085938,847.5477294921875,21711.203125,2573.546142578125,699.6063232421875,13755.7685546875,5244.45947265625,106757.5390625,42000.4375,12873.859375,19543.310546875,729110.9375,67352.2578125,21146.185546875,210368.3125,198928.09375,132265.84375,85475.671875,21010.39453125,38923.7421875,1269135.125,74416.015625,30186.4140625,430168.25,211477.125]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>comm<\/th>\n      <th>acts<\/th>\n      <th>reg<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"comm","targets":1},{"name":"acts","targets":2},{"name":"reg","targets":3},{"name":"Freq","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-the-data" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="exploring-the-data"><span class="header-section-number">2.1.4</span> Exploring the data</h3>
<p>There are many options for exploring these databases in R. This can be useful for building a descriptive analysis of the database, identifying patterns, creating data dashboards and so on.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 5: Plot the <code>vmfp_food</code> object using <code>barplot()</code> function
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot vmfp_food using barplot() function in R</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>?????(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  ?????,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(vmfp_food),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Imported purchases, by firms, at producers prices (million US$)"</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot vmfp_food using barplot() function in R</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  vmfp_food,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(vmfp_food),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Imported purchases, by firms, at producers prices (million US$)"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="roadmap_gtapinr_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="initializing-the-gtap-model-file-and-database-in-r" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="initializing-the-gtap-model-file-and-database-in-r"><span class="header-section-number">2.2</span> Initializing the GTAP model file and database in R</h2>
<p>In this step, you will convert the standard GTAP model file in the TABLO language into a format that R can understand using <code>tabloToR</code>. This requires setting the path to the model’s TABLO file, initializing a <code>GEMModel</code> object in R and assigning to this object the paths for the model and database files.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 6: Assign model file and database after initializing a <code>GEMModel</code> object.
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: The order of the code matters! </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#       Errors will occur if the order is wrong.</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1. Initialize a new `GEModel` object using tabloToR package</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> ?????<span class="sc">::</span>GEModel<span class="sc">$</span><span class="fu">new</span>() </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2. Assign model file</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">loadTablo</span>(?????) </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3. Assign model database</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">loadData</span>(?????)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: The order of the code matters! </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#       Errors will occur if the order is wrong.</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1. Initialize a new `GEModel` object using tabloToR package</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> tabloToR<span class="sc">::</span>GEModel<span class="sc">$</span><span class="fu">new</span>() <span class="co">#</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2. Assign model file</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">loadTablo</span>(<span class="st">"model/GTAPv7.tab"</span>) <span class="co">#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3. Assign model database</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">loadData</span>(database) <span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The first step calls the function <code>GEModel$new()</code> which creates a new instance of the <code>GEModel</code> class. It is an empty object which represents the model, its inputs and outputs.</p>
<p>The second step calls the function <code>loadTablo()</code> which interprets a TABLO model and turns it into an R code inside the <code>GEModel</code> object. This is achieved through a process that interprets and translates different components of the model file such as statements like <em>Read</em>, <em>Set</em>, <em>Coefficient</em>, <em>Variable</em>, <em>Formula</em>, <em>Equation</em>, <em>Parameter</em>, <em>Mapping</em>, and so on. Each category of commands is handled in a specific way to ensure they are correctly represented in R. The correct labeling of each statement into its appropriate group is essential for the subsequent definition and construction of the matrix that will be inverted during the simulation. This precise organization is key to maintaining the integrity of the model’s structure and calculations as it transitions into the R environment.</p>
<p>The last step call the function <code>loadData()</code> which initializes the data that will be used by the <em>GEModel</em> object</p>
<p>Note that errors will occur if the sequence are not followed correctly.</p>
</div>
</div>
</div>
</section>
<section id="setup-the-model-closure-and-shocks" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="setup-the-model-closure-and-shocks"><span class="header-section-number">2.3</span> Setup the model closure and shocks</h2>
<p>In this step, you will focus on setting up the <strong>closure</strong> conditions and applying specific <strong>shocks</strong> to the model. The closure assigns which variables are endogenously calculated within the model and exogenously dictated outside the model. Once the closure is defined, you will define the vectors of shocks which are the changes to the model’s exogenous variables that simulate different scenarios, such as economic or policy changes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 7: Define the exogenous variables in model closure
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create character object in R which lists all exogenous variables</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>exogenous_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'afall'</span>, <span class="st">'afcom'</span>, <span class="st">'afeall'</span>, <span class="st">'afecom'</span>, <span class="st">'afereg'</span>, <span class="st">'afesec'</span>, <span class="st">'afreg'</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'afsec'</span>, <span class="st">'aintall'</span>, <span class="st">'aintreg'</span>, <span class="st">'aintsec'</span>, <span class="st">'ams'</span>, <span class="st">'aoall'</span>, <span class="st">'aoreg'</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">'aosec'</span>, <span class="st">'atall'</span>, <span class="st">'atd'</span>, <span class="st">'atf'</span>, <span class="st">'atm'</span>, <span class="st">'ats'</span>, <span class="st">'au'</span>, <span class="st">'avaall'</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">'avareg'</span>, <span class="st">'avasec'</span>, <span class="st">'cgdslack'</span>, <span class="st">'dpgov'</span>, <span class="st">'dppriv'</span>, <span class="st">'dpsave'</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'endwslack'</span>, <span class="st">'incomeslack'</span>, <span class="st">'pfactwld'</span>, <span class="st">'?????'</span>, <span class="st">'profitslack'</span>, </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">'psaveslack'</span>, <span class="st">'qe'</span>, <span class="st">'qesf'</span>, <span class="st">'tfd'</span>, <span class="st">'tfe'</span>, <span class="st">'tfm'</span>, <span class="st">'tgd'</span>, <span class="st">'tgm'</span>, </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">'tid'</span>, <span class="st">'tim'</span>, <span class="st">'tinc'</span>, <span class="st">'tm'</span>, <span class="st">'tms'</span>, <span class="st">'to'</span>, <span class="st">'tpdall'</span>, <span class="st">'tpmall'</span>, </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">'tpreg'</span>, <span class="st">'tradslack'</span>, <span class="st">'tx'</span>, <span class="st">'txs'</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create character object in R which lists all exogenous variables</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>exogenous_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'afall'</span>, <span class="st">'afcom'</span>, <span class="st">'afeall'</span>, <span class="st">'afecom'</span>, <span class="st">'afereg'</span>, <span class="st">'afesec'</span>, <span class="st">'afreg'</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'afsec'</span>, <span class="st">'aintall'</span>, <span class="st">'aintreg'</span>, <span class="st">'aintsec'</span>, <span class="st">'ams'</span>, <span class="st">'aoall'</span>, <span class="st">'aoreg'</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'aosec'</span>, <span class="st">'atall'</span>, <span class="st">'atd'</span>, <span class="st">'atf'</span>, <span class="st">'atm'</span>, <span class="st">'ats'</span>, <span class="st">'au'</span>, <span class="st">'avaall'</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">'avareg'</span>, <span class="st">'avasec'</span>, <span class="st">'cgdslack'</span>, <span class="st">'dpgov'</span>, <span class="st">'dppriv'</span>, <span class="st">'dpsave'</span>, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">'endwslack'</span>, <span class="st">'incomeslack'</span>, <span class="st">'pfactwld'</span>, <span class="st">'pop'</span>, <span class="st">'profitslack'</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'psaveslack'</span>, <span class="st">'qe'</span>, <span class="st">'qesf'</span>, <span class="st">'tfd'</span>, <span class="st">'tfe'</span>, <span class="st">'tfm'</span>, <span class="st">'tgd'</span>, <span class="st">'tgm'</span>, </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">'tid'</span>, <span class="st">'tim'</span>, <span class="st">'tinc'</span>, <span class="st">'tm'</span>, <span class="st">'tms'</span>, <span class="st">'to'</span>, <span class="st">'tpdall'</span>, <span class="st">'tpmall'</span>, </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">'tpreg'</span>, <span class="st">'tradslack'</span>, <span class="st">'tx'</span>, <span class="st">'txs'</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 8: Setting shocks to all exogenous variables in the <code>GEModel</code> object to zero
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop statement to assign zero values to each exogenous </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   variable in the GEModel object </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> ??????) {</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  ?????<span class="sc">$</span>variableValues[[var]][] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop statement to assign zero values to each exogenous </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   variable in the GEModel object</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> exogenous_variables) {</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">$</span>variableValues[[var]][] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 9: Applying shocks to key exogenous variables in the <code>GEModel</code> object
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 10% output augmenting productivity shock</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to 'food' sectors in 'ssa' and 'eu' regions in the GEModel object </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>?????<span class="sc">$</span>variableValues<span class="sc">$</span>?????[<span class="st">"?????"</span>, <span class="st">"?????"</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>?????<span class="sc">$</span>variableValues<span class="sc">$</span>?????[<span class="st">"?????"</span>, <span class="st">"?????"</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>?????<span class="sc">$</span>variableValues<span class="sc">$</span>?????</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 10% productivity shock to 'food' sectors in 'ssa' and 'eu' regions </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in the GEModel object </span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>variableValues<span class="sc">$</span>aoall[<span class="st">"food"</span>, <span class="st">"ssa"</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>variableValues<span class="sc">$</span>aoall[<span class="st">"food"</span>, <span class="st">"eu"</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>variableValues<span class="sc">$</span>aoall</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       reg
acts    ssa eu row
  food   10 10   0
  mnfcs   0  0   0
  svces   0  0   0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explanation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Setting up the model closure requires identifying which variables are exogenous and then assigning zero values within the <code>GEModel</code> object using the <code>variableValues()</code> function. Use the <code>loop</code> function in R to efficiently assign zero values to all exogenous variables.</p>
<p><code>tabloToR</code> automatically assigns other variables which are not shocked as endogenous variables.</p>
<p>When shocking variables for your simulations, you need to use the <code>variableValues()</code> function. Depending on the variable that you are shocking, you need to manually assign the indices (e.g.&nbsp;GTAP sector, endowment, region).</p>
</div>
</div>
</div>
</section>
<section id="solving-the-model-and-viewing-model-outputs" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="solving-the-model-and-viewing-model-outputs"><span class="header-section-number">2.4</span> Solving the model and viewing model outputs</h2>
<p>You are now ready to solve the model, bringing together all the elements that you have prepared: reading in and assigning GTAP model and database, defining model closure, and assigning shocks to key variables.</p>
<p>In this step, <code>tabloToR</code> solves the model’s matrix, which is a representation of the equations from the model. The model’s execution not only solves the matrix but also carries out the calculations defined in the model’s formulas. Post-simulation processes are also done (if they are defined in the model <code>TABLO</code> file) using the model’s output.</p>
<p>The default solution method is <em>Euler</em><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> method. This is a multi-step procedure that divides the exogenous shock into a (user-specified) number of equal components. In the current version, users can define the number of iterations and steps for only a two-step solution.</p>
<p>It is important to note that once the model is solved, the model’s data is also updated. This means that running the same solveModel()function again, will apply the shocks to the updated model data.</p>
<p>The model outputs are stored as an <code>outputData</code> object. The updated values of the basedata can be viewed by calling <code>$data</code> in <code>GEModel</code> object.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 10: Solve the <code>GEModel</code> object using Euler method with 3 iterations and 1-step and 6-step solution
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve the `GEModel` object using Euler with </span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   3 iterations and 1-step and 6-step solution</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>?????<span class="sc">$</span><span class="fu">solveModel</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> ?????,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">steps =</span> <span class="fu">c</span>(?????,?????)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve the `GEModel` object using Euler with </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   3 iterations and 1-step and 6-step solution</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">solveModel</span>(</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">3</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">steps =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Iteration 1/3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 1/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 2/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 2/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 3/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 4/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 5/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 6/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Iteration 2/3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 1/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 2/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 2/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 3/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 4/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 5/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 6/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Iteration 3/3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 1/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step set 2/2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 1/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 2/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 3/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 4/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 5/6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Step 6/6</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 11: Extract the percent changes in total output in each region and plot
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the percent changes in total output in each region and plot</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">=</span> outputData<span class="sc">$</span>????</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  plotdata,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(plotdata),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Total output by activity and region (%)"</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the percent changes in total output in each region and plot</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">=</span> outputData<span class="sc">$</span>qo</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  plotdata,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(plotdata),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Total output by activity and region (%)"</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="roadmap_gtapinr_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 12: Extract the updated value of vmfp for the food sector and plot
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the updated value of vmfp for the food sector </span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from the `data` used by the GEModel object and plot</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>vmfp_food <span class="ot">&lt;-</span> ?????<span class="sc">$</span>?????<span class="sc">$</span>vmfp[,<span class="st">"food"</span>,]</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>vmfp_food</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  vmfp_food,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(vmfp_food),</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Imported purchases, by firms, at producers prices (million US$)"</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show the answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the updated value of vmfp for the food sector </span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from the `data` used by the GEModel object and plot</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>vmfp_food <span class="ot">&lt;-</span> model<span class="sc">$</span>data<span class="sc">$</span>vmfp[,<span class="st">"food"</span>,]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>vmfp_food</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       reg
comm         ssa       eu       row
  food  2386.668 88820.96 132952.64
  mnfcs 4764.728 41639.26  83289.94
  svces 1295.402 12767.90  20467.17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  vmfp_food,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">rownames</span>(vmfp_food),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Imported purchases, by firms, at producers prices (million US$)"</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="roadmap_gtapinr_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://doi.org/10.21642/JGEA.020101AF">Corong, E. L., Hertel, T. W., McDougall, R., Tsigas, M. E., &amp; van der Mensbrugghe, D. (2017). The Standard GTAP Model, Version 7. Journal of Global Economic Analysis, 2(1), 1–119. https://doi.org/10.21642/JGEA.020101AF</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://doi.org/10.21642/JGEA.080101AF">Ivanic, M. (2023). GEMPACK simulations in R: A demonstration of running the GTAP model and processing its results entirely in R using packages HARr and tabloToR. Journal of Global Economic Analysis, 8(1). https://doi.org/10.21642/JGEA.080101AF</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://www.copsmodels.com/webhelp/rungtap/index.html?hc_solmethod.htm">https://www.copsmodels.com/webhelp/rungtap/index.html?hc_solmethod.htm</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>